Bootstrap: library
From: ubuntu:18.04

%labels
Author: Juan Felipe Castro C
Date: 01/06/2020
Mail: felipe.castro@embl.it

%post

    # SET LOCALE #
    export LC_ALL=C

    # INSTALL MINICONDA AND INCLUDE universe CHANNEL#
    apt-get update && apt-get install -y gcc default-jdk wget software-properties-common libncurses5-dev libncursesw5-dev
    apt-add-repository -y universe
    wget -O $HOME/miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash $HOME/miniconda.sh -b -p /miniconda
    export PATH="/miniconda/bin:$PATH"
    rm $HOME/miniconda.sh

    # CONDA INSTALLS (INCLUDING eXpress) #
    conda config --add channels defaults
    conda config --add channels bioconda
    conda config --add channels r
    conda config --add channels conda-forge

    conda install -y -c bioconda parallel-fastq-dump
    conda install -y -c bioconda express=1.5.1
    conda install -y -c r r-base=4.0.2
    conda install -y -c bioconda macs2=2.2.7.1
    conda install -y -c bioconda samtools=1.10
    conda install -y -c bioconda ucsc-liftover
    conda install -y -c bioconda ucsc-bedgraphtobigwig
    conda install -y -c bioconda bedtools
    conda install -y -c bioconda bowtie
    conda install -y -c bioconda bowtie2

    # DROMPA3 INSTALLS #
    apt-get install -y git gcc libgtk2.0-dev libgsl-dev make
    cd /opt && git clone https://github.com/coherentgraphics/cpdf-binaries
    git clone https://github.com/rnakato/DROMPA3 && cd DROMPA3
    make 
    cd

    # GIBBS SAMPLING DOWNLOAD #
    cd /opt
    mkdir gibbs_scripts
    wget -O gibbs_scripts.tar.gz http://esbg.gatech.edu/page/software/map/downloads/scripts.tar.gz
    tar -xzf gibbs_scripts.tar.gz -C gibbs_scripts
    rm gibbs_scripts.tar.gz
    cd 

    # CSEM INSTALL #
    cd /opt
    wget -O csem.tar.gz http://deweylab.biostat.wisc.edu/csem/src/csem-2.4.tar.gz
    tar -xzf csem.tar.gz && chmod -R 777 csem-2.4
    cd csem-2.4 && make
    rm ../csem.tar.gz
    cd

    # LONUT DOWNLOAD #
    cd /opt
    wget -O lonut.tar.gz http://jinlab.net/LONUT/files/lonut.tar.gz
    tar -xzf lonut.tar.gz
    rm lonut.tar.gz
    cd

    # R INSTALLS #
    R --slave -e 'install.packages("optparse", repos="https://cloud.r-project.org/")'
    R --slave -e 'install.packages("BiocManager", repos="https://cloud.r-project.org/")'
    R --slave -e 'BiocManager::install(version = "3.11")'
    R --slave -e 'BiocManager::install("mosaics")'
    
%environment
export LC_ALL=C
export LC_CTYPE=C 
export LC_COLLATE=C
export LC_TIME=C    
export LC_MESSAGES=C
export LC_MONETARY=C
export LC_PAPER=C 
export LC_MEASUREMENT=C 
export PATH="/miniconda/bin:$PATH:/opt/DROMPA3:/opt/csem-2.4:/opt/LONUT:/opt/cpdf-binaries/Linux-Intel-64bit"
